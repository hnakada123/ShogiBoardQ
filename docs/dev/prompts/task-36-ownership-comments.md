# Task 36: 所有/非所有コメントの実態合わせ

## Workstream C-3: 所有権/可変性の是正

## 目的

メンバ変数のコメント（「所有」「非所有」）と実際のライフサイクルを一致させ、コードの意図を正確に表現する。

## 背景

- メンバコメントで「非所有」と記載されているが、実際には所有しているケースがある可能性
- 所有権の意図が不明確だと、メモリリークや二重解放のリスクが高まる
- コメントと実態の乖離は保守性を低下させる

## 対象ファイル

- `src/app/mainwindow.h`（多数のメンバ変数）
- `src/game/matchcoordinator.h`
- その他、所有権コメントが付与されているヘッダファイル

## 実装内容

1. 所有権コメント（「所有」「非所有」「// owned」「// not owned」等）が付いているメンバ変数を洗い出す

2. 各メンバ変数の実際のライフサイクルを確認する:
   - 誰が `new` しているか
   - 誰が `delete` しているか（または Qt 親子管理か）
   - スコープ外でアクセスされるリスクはないか

3. コメントと実態が一致しない箇所を修正する:
   - コメントが間違っている場合はコメントを修正
   - 所有権の実装が不適切な場合は実装を修正
   - 曖昧な箇所には適切なコメントを追加

4. 可能であれば、所有を `std::unique_ptr` や Qt 親子管理で明示する

## 制約

- 既存挙動を変更しない
- 所有権の変更は慎重に行い、クラッシュ・リークを導入しない
- 大規模な所有権変更は避け、コメント修正を優先する

## 受け入れ条件

- 所有権コメントと実際のライフサイクルが一致している
- 曖昧だった所有権が明確になっている
- クラッシュ/リーク回帰がない

## 検証コマンド

```bash
cmake -B build -S .
cmake --build build
QT_QPA_PLATFORM=offscreen ctest --test-dir build --output-on-failure -j4
```

## 出力

- 変更ファイル一覧
- 修正した所有権コメントの一覧
- 発見した所有権の問題点
- 回帰リスク
- 残課題
