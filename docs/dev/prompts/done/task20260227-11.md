# Task 11: kifuloadcoordinator.cpp 分割（ISSUE-023）

## フェーズ
C: 巨大ファイル上位の削減

## 前提条件
- Task 09（ISSUE-021）が完了していること

## 目的
`kifuloadcoordinator.cpp`（1263行）の棋譜ロードにおけるI/O責務と適用責務を分離する。

## 現状
- `src/kifu/kifuloadcoordinator.cpp`: 1263行
- ファイル読み込み・フォーマット判定・変換・盤面反映が一体化

## 対象ファイル
- `src/kifu/kifuloadcoordinator.h` — 分割元ヘッダー
- `src/kifu/kifuloadcoordinator.cpp` — 分割元実装
- `src/kifu/kifuioservice.h/.cpp` — 既存I/Oサービス（参照）
- 新規クラスファイル
- `CMakeLists.txt`

## 詳細手順

### Step 1: 責務の分析
`kifuloadcoordinator.cpp` を全文読み、メソッドを以下の3層に分類:

1. **I/O層** — ファイル読み込み・フォーマット判定・文字コード変換
2. **変換層** — 棋譜フォーマットからSFENへの変換呼び出し
3. **適用層** — 変換結果の盤面モデルへの反映・UIへの通知

### Step 2: I/O層の抽出（PR-023-a 相当）
- ファイル読み込みとフォーマット判定を `KifuFileReader` として抽出
- 既存の `KifuIoService` との役割分担を明確化
- 入力: ファイルパス → 出力: 生テキスト + 検出フォーマット

### Step 3: 適用層の抽出（PR-023-b 相当）
- 変換結果を盤面に反映するロジックを `KifuApplyService` として抽出
- 入力: SFEN データ → 出力: モデル更新・シグナル発行

### Step 4: KifuLoadCoordinator のオーケストレータ化
- `KifuLoadCoordinator` は I/O → 変換 → 適用 の3段パイプラインの調整役に専念
- 各段のエラーハンドリングを統一

### Step 5: CMakeLists.txt の更新

### Step 6: ビルド・テスト
```bash
cmake --build build
cd build && ctest --output-on-failure
```

## 完了条件
- [ ] 棋譜ロード系テストが全 Pass
- [ ] `kifuloadcoordinator.cpp` の行数が削減（目標: 600行以下）
- [ ] I/O / 変換 / 適用 の3層が分離されている
- [ ] 構造KPIテストが Pass

## 検証コマンド
```bash
cmake --build build
cd build && ctest --output-on-failure
wc -l src/kifu/kifuloadcoordinator.cpp
cd build && ctest --output-on-failure -R tst_structural_kpi
# 棋譜関連テスト
cd build && ctest --output-on-failure -R kifu
```
