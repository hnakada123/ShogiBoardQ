# Task 07: 対局フロー回帰テスト強化（ISSUE-013）

## フェーズ
B: 高リスク領域の分割（司令塔）

## 前提条件
- Task 05（ISSUE-011）、Task 06（ISSUE-012）が完了していること

## 目的
MatchCoordinator / GameStartCoordinator の分割後の回帰を検知するため、対局開始・再開・中断・終局・再開始のテストケースを拡充する。

## 対象ファイル
- `tests/tst_game_start_flow.cpp` — 対局開始フローテスト（既存）
- `tests/tst_preset_gamestart_cleanup.cpp` — プリセット対局テスト（既存）
- `tests/tst_integration.cpp` — 統合テスト（既存）
- 新規テストファイル（必要に応じて）

## 詳細手順

### Step 1: 既存テストの確認
以下のテストファイルを読み、現在のカバレッジを把握:
```
tests/tst_game_start_flow.cpp
tests/tst_preset_gamestart_cleanup.cpp
tests/tst_integration.cpp
```

### Step 2: 不足ケースの特定
以下のシナリオがテストされているか確認し、不足分をリストアップ:

1. **対局開始**: HvH / HvE / EvE の各モードで対局が正しく開始されるか
2. **対局再開**: 中断後の再開時に状態が正しく復元されるか
3. **対局中断**: 中断時にリソースが正しく解放されるか
4. **終局処理**: 投了・詰み・千日手・持将棋の各パターン
5. **再開始**: 終局後に新しい対局を開始できるか
6. **時間制御**: 持ち時間切れでの対局終了

### Step 3: テストケースの追加
不足しているケースを追加する。テストはQtTestフレームワークを使用:

```cpp
void Tst_GameStartFlow::startAndStopHvH()
{
    // HvH対局の開始→中断→リソース解放の確認
}

void Tst_GameStartFlow::restartAfterGameEnd()
{
    // 終局後の再開始が正常動作するか
}
```

### Step 4: テスト登録
CMakeLists.txt のテスト定義に新しいテストを追加（必要な場合）。

### Step 5: ビルド・テスト実行
```bash
cmake --build build
cd build && ctest --output-on-failure
```

## 完了条件
- [ ] 対局開始/中断/終局/再開始のテストケースが追加されている
- [ ] 全テスト Pass（`ctest --output-on-failure`）
- [ ] 分割で壊れやすい箇所が防波堤テストでカバーされている

## 検証コマンド
```bash
cmake --build build
cd build && ctest --output-on-failure
cd build && ctest -N | grep -i game  # game関連テスト一覧
```
