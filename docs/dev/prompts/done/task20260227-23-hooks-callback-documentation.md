# Task 23: Hooks/コールバックパターンの整理と文書化

## 目的
プロジェクト全体で使用されている `std::function` コールバック（Hooks パターン）を整理・文書化し、呼び出しフローの追跡性を改善する。

## 背景
MainWindow のリファクタリングにより、多数の `std::function` コールバックが Deps/Hooks 構造体を通じて注入されている。これにより:
- 型安全な依存性注入が実現されている（利点）
- コールバックの呼び出し元→先の追跡が IDE の「参照の検索」では困難（課題）
- 新規開発者がフローを理解するのにコストがかかる（課題）

特に以下のクラスが多数のコールバックを持つ:
- `MatchCoordinator::Hooks`（~20 コールバック）
- `GameEndHandler::Hooks`
- `GameStartOrchestrator::Hooks`
- 各種 Wiring クラスの `Deps` 構造体

## 作業内容

### 1. コールバック使用箇所の全数調査
プロジェクト全体で `std::function` を使用している構造体を洗い出す:
- クラス名・構造体名
- コールバックの数
- 各コールバックの用途（1行説明）

### 2. 呼び出しフロー図の作成
主要なフローについて、コールバック経由の呼び出しチェーンを文書化する:

#### 対象フロー
1. 対局開始フロー: メニュー操作 → GameStartOrchestrator → MatchCoordinator → GUI更新
2. 指し手適用フロー: 盤面クリック → BoardInteraction → MatchCoordinator → 棋譜更新 → GUI更新
3. 対局終了フロー: 終局検出 → GameEndHandler → MatchCoordinator → GUI更新
4. エンジン思考フロー: エンジン出力 → UsiProtocolHandler → MatchCoordinator → GUI更新

各フローについて:
- シグナル/スロット接続（直接）とコールバック経由の呼び出しを区別する
- 呼び出しチェーンを Mermaid シーケンス図で記述する

### 3. コールバック削減の検討
以下の観点で削減可能なコールバックを特定する:

#### A: シグナル/スロットへの置換
- コールバックの呼び出し元と先が共に QObject の場合、シグナル/スロットに置換可能
- 置換により IDE の追跡性が改善する

#### B: 不要なコールバックの削除
- 使用されていないコールバック（設定されているが呼ばれない）
- 常に同じ値が設定されるコールバック（直接参照に置換可能）

#### C: グループ化による整理
- 関連するコールバックのインターフェース化
- Hooks 構造体の分割（GUI系/Data系/Engine系）

### 4. Doxygen コメントの追加
残存するコールバックに対して、以下を記述する:
- `@brief` コールバックの目的
- `@note` 設定元（どのクラスが注入するか）
- `@see` 対応するシグナル/スロット（あれば）

## 出力
- `docs/dev/done/hooks-callback-analysis.md` - 全数調査結果と呼び出しフロー図
- 各 Hooks/Deps 構造体への Doxygen コメント追加（コード修正）

## 完了条件
- [ ] 全 `std::function` コールバック構造体がリストアップされている
- [ ] 主要4フローのシーケンス図が作成されている
- [ ] 削減可能なコールバックが特定されている
- [ ] 残存コールバックに Doxygen コメントが追加されている

## 注意事項
- コールバックの削減は、この task では分析と文書化のみ。実際の削減は別 task とする
- CLAUDE.md の「connect でラムダ不使用」ルールとの整合性を確認する
- コールバックパターン自体は有効な設計パターンであり、全廃を目指すものではない
- IDE での追跡性改善が主目的であることを意識する
