# Task 27: 例外リスト整理 — knownLargeFiles（ISSUE-051）

## フェーズ
G: 収束

## 前提条件
- Task 26（ISSUE-050: KPI 再計測と閾値引き下げ）が完了していること

## 目的
`tst_structural_kpi.cpp` の `knownLargeFiles` 例外リストを実態と一致させ、例外の常態化を防ぐ。

## 対象ファイル
- `tests/tst_structural_kpi.cpp` — 例外リストの更新

## 詳細手順

### Step 1: 現在の例外リストの確認
```
tests/tst_structural_kpi.cpp
```
を読み、`knownLargeFiles`（または同等の例外リスト）の内容を把握する。

### Step 2: 各例外ファイルの実測
例外リストに記載されている全ファイルの行数を計測:

```bash
wc -l <例外リストの各ファイルパス>
```

### Step 3: 例外の分類
各例外を以下に分類:

1. **削除可能**: 分割により600行以下に収まったファイル → 例外から削除
2. **上限更新**: 縮小したが600行超のままのファイル → 上限を実測値 + マージンに更新
3. **据え置き**: 今回のスコープ外で未対応のファイル → 次期 Issue 番号を備考に追記

### Step 4: 例外リストの更新
```cpp
// 更新例
const QMap<QString, int> knownLargeFiles = {
    // 削除: csagamecoordinator.cpp (1569 → 750に削減 → 例外不要)
    // 更新: kifudisplaycoordinator.cpp (1412 → 800に削減)
    {"src/ui/coordinators/kifudisplaycoordinator.cpp", 850},
    // 据え置き（次期対応）
    {"src/widgets/evaluationchartwidget.cpp", 1050}, // TODO: ISSUE-XXX
};
```

### Step 5: 例外追加の抑制ルール確認
- 新しい例外を追加する場合は「削減計画の Issue 番号」を同時に記載する
- 期限（例: 次スプリント）を付与する

### Step 6: ビルド・テスト
```bash
cmake --build build
cd build && ctest --output-on-failure
cd build && ctest --output-on-failure -R tst_structural_kpi
```

## 完了条件
- [ ] 例外リストが実態と一致している
- [ ] 削除可能な例外が削除されている
- [ ] 残存する例外の上限値が実測値 + マージンに更新されている
- [ ] 据え置きの例外には次期 Issue 番号が記載されている
- [ ] 全テスト Pass

## 検証コマンド
```bash
cmake --build build
cd build && ctest --output-on-failure -R tst_structural_kpi
# 例外リスト内ファイルの実測
grep -oP '"[^"]*\.cpp"' tests/tst_structural_kpi.cpp | tr -d '"' | while read f; do wc -l "$f"; done
```
