# Task 09: kifudisplaycoordinator.cpp 分割（ISSUE-021）

## フェーズ
C: 巨大ファイル上位の削減

## 前提条件
- Task 07（ISSUE-013）が完了していること

## 目的
`kifudisplaycoordinator.cpp`（1412行）のUI表示制御の責務集中を緩和し、変更容易性を向上させる。

## 現状
- `src/ui/coordinators/kifudisplaycoordinator.cpp`: 1412行
- 棋譜表示のフォーマット・選択状態同期・反映処理が集中

## 対象ファイル
- `src/ui/coordinators/kifudisplaycoordinator.h` — 分割元ヘッダー
- `src/ui/coordinators/kifudisplaycoordinator.cpp` — 分割元実装
- 新規クラスファイル
- `CMakeLists.txt`

## 詳細手順

### Step 1: 責務の分析
`kifudisplaycoordinator.cpp` を全文読み、メソッドを以下に分類:

1. **表示データ計算** — 棋譜テキストのフォーマット・変換
2. **選択状態同期** — ツリービュー/リストビューの選択とモデルの同期
3. **反映処理** — UIウィジェットへのデータ反映・更新
4. **イベントハンドラ** — ユーザー操作への応答

### Step 2: Presenter 抽出の設計（PR-021-a 相当）
- 表示データの計算ロジックを `KifuDisplayPresenter` として抽出
- 入力: 棋譜データモデル → 出力: 表示用データ
- UIフレームワーク非依存にできる部分を特定

### Step 3: 状態同期の抽出（PR-021-b 相当）
- ツリー/リストの選択状態管理を `KifuSelectionSync` として抽出
- 選択変更時の連鎖更新ロジックを集約

### Step 4: 段階的実装
1. 抽出対象のメソッド群を特定し、依存関係を整理
2. 新クラスを作成（既存のDepsパターンに従う）
3. `KifuDisplayCoordinator` から委譲
4. 各段階でテスト実行

### Step 5: CMakeLists.txt の更新

### Step 6: ビルド・テスト
```bash
cmake --build build
cd build && ctest --output-on-failure
```

## 完了条件
- [ ] UI表示整合テストを維持（全テスト Pass）
- [ ] `kifudisplaycoordinator.cpp` の行数が削減（目標: 800行以下）
- [ ] 表示計算と状態同期の責務が分離されている
- [ ] 構造KPIテストが Pass

## 検証コマンド
```bash
cmake --build build
cd build && ctest --output-on-failure
wc -l src/ui/coordinators/kifudisplaycoordinator.cpp
cd build && ctest --output-on-failure -R tst_structural_kpi
```
