# Task 20: ダイアログボイラープレート共通ユーティリティ設計（ISSUE-060）

## フェーズ
F: ダイアログ品質・テスト拡充

## 前提条件
- なし（設計タスク、独立して着手可能）

## 目的
ダイアログ間で重複している2つのパターン（サイズ保存/復元、フォント増減）を共通化するための設計を固定する。コード変更は行わず、設計文書のみを成果物とする。

## 現状の重複
### サイズ保存/復元（12箇所）
各ダイアログで以下のパターンが繰り返されている:
```cpp
// コンストラクタ
QSize savedSize = SettingsService::xxxDialogSize();
if (savedSize.isValid() && savedSize.width() > 100 && savedSize.height() > 100) {
    resize(savedSize);
} else {
    resize(600, 500);  // デフォルトサイズ
}

// closeEvent または デストラクタ
SettingsService::setXxxDialogSize(size());
```

### フォント増減（6ダイアログ）
```cpp
void XxxDialog::onFontIncrease() {
    if (m_fontSize < 24) {
        m_fontSize++;
        updateFontSize();
        SettingsService::setXxxFontSize(m_fontSize);
    }
}
void XxxDialog::onFontDecrease() {
    if (m_fontSize > 8) {
        m_fontSize--;
        updateFontSize();
        SettingsService::setXxxFontSize(m_fontSize);
    }
}
void XxxDialog::updateFontSize() {
    QFont f = font();
    f.setPointSize(m_fontSize);
    // 各ウィジェットにフォント適用
}
```

## 対象ファイル（読み取り対象）
- `src/dialogs/josekiwindowui.cpp` — サイズ保存パターンの典型
- `src/dialogs/csagamedialog.cpp` — サイズ + フォント両方の典型
- `src/dialogs/considerationdialog.cpp` — フォントパターンの典型
- `src/dialogs/pvboarddialog.cpp` — サイズ + minimumSize
- `src/common/` — 既存の共通ユーティリティ（配置先の参考）

## 詳細手順

### Step 1: 全対象ダイアログの重複パターンを精査
上記の対象ダイアログを読み、パターンの微差異を特定:
- デフォルトサイズの違い
- minimumSize の有無
- フォント適用先の違い（全体 vs 特定ウィジェット）
- 保存先の SettingsService メソッド名

### Step 2: 共通ユーティリティの設計
以下の2つのアプローチを比較検討:

#### 方式A: フリー関数（namespace）
```cpp
namespace DialogUtils {
    void restoreDialogSize(QWidget* dialog, const QSize& saved, const QSize& fallback);
    void saveDialogSize(QWidget* dialog, std::function<void(const QSize&)> setter);
}
```

#### 方式B: ヘルパークラス
```cpp
class FontSizeHelper {
public:
    FontSizeHelper(int initial, int min, int max, std::function<void(int)> saveFn);
    void increase();
    void decrease();
    int fontSize() const;
};
```

### Step 3: 適用方式の決定
- サイズ保存/復元 → フリー関数（方式A）が適切（状態不要）
- フォント増減 → ヘルパークラス（方式B）が適切（状態管理あり）

### Step 4: 設計文書の作成
`docs/dev/dialog-utilities-design.md` を作成:
- 現在の重複パターン一覧
- 共通ユーティリティのインターフェース
- 各ダイアログへの適用方法
- 移行手順

## 完了条件
- [ ] `docs/dev/dialog-utilities-design.md` が作成されている
- [ ] サイズ保存/復元の共通関数設計が含まれている
- [ ] フォント増減の共通ヘルパー設計が含まれている
- [ ] 各ダイアログへの適用方法が記載されている
- [ ] コード変更は行っていない

## 検証コマンド
```bash
ls docs/dev/dialog-utilities-design.md
```
