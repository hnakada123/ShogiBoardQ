# Task 14: KIF/KI2 コンバータの共通パイプライン移行（ISSUE-032）

## フェーズ
D: 変換器共通化と異常系強化

## 前提条件
- Task 13（ISSUE-031: parsecommon 抽出）が完了していること

## 目的
KIF/KI2 コンバータを共通パイプラインへ移行し、重複ロジックを削減する。

## 対象ファイル
- `src/kifu/formats/kiftosfenconverter.h/.cpp` — KIF形式コンバータ
- `src/kifu/formats/ki2tosfenconverter.h/.cpp` — KI2形式コンバータ
- `src/kifu/formats/parsecommon.h/.cpp` — 共通処理
- 設計文書: `docs/dev/converter-pipeline-design.md`

## 詳細手順

### Step 1: KIF コンバータの移行（PR-032-a 相当）
1. `kiftosfenconverter.cpp` を読み、共通パイプラインに移行可能な部分を特定
2. 独自の変換ロジックを `parsecommon` の共通関数呼び出しに置換
3. 形式固有のパース部分は Lexer/Parser として整理
4. テスト実行: `ctest --output-on-failure -R kif`

### Step 2: KI2 コンバータの移行（PR-032-b 相当）
1. `ki2tosfenconverter.cpp` を読み、KIF との共通部分を特定
2. KIF 移行で確立したパターンを適用
3. KI2 固有の表記（「同」「右」「左」「上」「下」「寄」「引」「打」等の相対表記）の処理を分離
4. テスト実行: `ctest --output-on-failure -R ki2`

### Step 3: ビルド・全テスト
```bash
cmake --build build
cd build && ctest --output-on-failure
```

## 完了条件
- [ ] `tst_kifconverter` / `tst_ki2converter` が全 Pass
- [ ] 全テスト Pass（`ctest --output-on-failure`）
- [ ] 共通処理が `parsecommon` 経由に統一されている
- [ ] 各コンバータの行数が削減されている

## 検証コマンド
```bash
cmake --build build
cd build && ctest --output-on-failure -R kif
cd build && ctest --output-on-failure -R ki2
cd build && ctest --output-on-failure
wc -l src/kifu/formats/kiftosfenconverter.cpp src/kifu/formats/ki2tosfenconverter.cpp
```
