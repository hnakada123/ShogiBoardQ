# Task 22: フォントサイズ増減パターンの共通化実装（ISSUE-062）

## フェーズ
F: ダイアログ品質・テスト拡充

## 前提条件
- Task 20（ISSUE-060: ダイアログボイラープレート共通ユーティリティ設計）が完了していること

## 目的
6ダイアログに重複している `onFontIncrease / onFontDecrease / updateFontSize` パターンを共通ヘルパーに集約する。

## 対象ファイル
- 新規: `src/common/fontsizehelper.h` — フォントサイズヘルパー宣言
- 新規: `src/common/fontsizehelper.cpp` — フォントサイズヘルパー実装
- `src/dialogs/considerationdialog.h/.cpp`
- `src/dialogs/csagamedialog.h/.cpp`
- `src/dialogs/csawaitingdialog.h/.cpp`（本体+ログの2セット）
- `src/dialogs/kifuanalysisdialog.h/.cpp`
- `src/dialogs/tsumeshogigeneratordialog.h/.cpp`
- `CMakeLists.txt`

## 詳細手順

### Step 1: 設計文書の確認
`docs/dev/dialog-utilities-design.md` を読み、フォント管理の設計に従う。

### Step 2: 各ダイアログのフォント管理の精査
各対象ダイアログの `onFontIncrease` / `onFontDecrease` / `updateFontSize` を読み、微差異を把握:
- フォントサイズの範囲（min/max）
- フォント適用先のウィジェット（全体 or 特定のテキストウィジェット）
- 保存先の SettingsService メソッド

### Step 3: FontSizeHelper クラスの実装
```cpp
// fontsizehelper.h
#pragma once
#include <functional>

class FontSizeHelper {
public:
    FontSizeHelper(int initialSize, int minSize, int maxSize,
                   std::function<void(int)> saveFn);

    void increase();
    void decrease();
    int fontSize() const;

private:
    int m_fontSize;
    int m_minSize;
    int m_maxSize;
    std::function<void(int)> m_saveFn;
};
```

```cpp
// fontsizehelper.cpp
#include "fontsizehelper.h"

FontSizeHelper::FontSizeHelper(int initialSize, int minSize, int maxSize,
                               std::function<void(int)> saveFn)
    : m_fontSize(initialSize)
    , m_minSize(minSize)
    , m_maxSize(maxSize)
    , m_saveFn(std::move(saveFn))
{
}

void FontSizeHelper::increase()
{
    if (m_fontSize < m_maxSize) {
        ++m_fontSize;
        m_saveFn(m_fontSize);
    }
}

void FontSizeHelper::decrease()
{
    if (m_fontSize > m_minSize) {
        --m_fontSize;
        m_saveFn(m_fontSize);
    }
}

int FontSizeHelper::fontSize() const { return m_fontSize; }
```

### Step 4: 各ダイアログの移行
各ダイアログの修正パターン:

```cpp
// Before (ヘッダー)
private:
    int m_fontSize;

// After (ヘッダー)
private:
    FontSizeHelper m_fontHelper;
```

```cpp
// Before (コンストラクタ)
m_fontSize = SettingsService::xxxFontSize();

// After (コンストラクタ)
// 初期化子リストで
, m_fontHelper(SettingsService::xxxFontSize(), 8, 24, SettingsService::setXxxFontSize)
```

```cpp
// Before
void XxxDialog::onFontIncrease() {
    if (m_fontSize < 24) {
        m_fontSize++;
        updateFontSize();
        SettingsService::setXxxFontSize(m_fontSize);
    }
}

// After
void XxxDialog::onFontIncrease() {
    m_fontHelper.increase();
    updateFontSize();
}
```

注意: `updateFontSize()` はダイアログ固有のUI反映なのでダイアログに残す。
ヘルパーはサイズ管理と保存のみ担当。

### Step 5: フォント範囲の定数化
```cpp
namespace {
    constexpr int kMinFontSize = 8;
    constexpr int kMaxFontSize = 24;
}
```

### Step 6: CMakeLists.txt の更新

### Step 7: ビルド・テスト
```bash
cmake --build build
cd build && ctest --output-on-failure
```

## 完了条件
- [ ] `src/common/fontsizehelper.h/.cpp` が作成されている
- [ ] フォント管理ロジック（範囲チェック + 保存）が1箇所に集約
- [ ] 各ダイアログの `onFontIncrease` / `onFontDecrease` が簡素化
- [ ] 振る舞い互換（全テスト Pass）

## 検証コマンド
```bash
cmake --build build
cd build && ctest --output-on-failure
# FontSizeHelper の使用確認
grep -rn "FontSizeHelper" src/dialogs/ --include="*.h" | wc -l
# 旧パターンの残存確認
grep -rn "m_fontSize < 24" src/dialogs/ --include="*.cpp" | wc -l
```
