# Task 18: GameRecordModel 分割の分析

## 目的
`GameRecordModel`（1729行 + ヘッダー）の責務を分析し、Model/Service/Presenter に分割する計画を策定する。

## 背景
`gamerecordmodel.cpp` は現在 1729行で、プロジェクト第2位の大きさ。
棋譜データの保持・操作・UI連携・分岐管理・コメント管理が同居しており、単一責任の原則に反している。

## 作業内容

### 1. 責務の洗い出し
`gamerecordmodel.cpp` の全メソッドを以下のカテゴリに分類する:

#### A: Pure Data Model（データ保持・アクセス）
- 棋譜ツリー構造の保持
- 指し手の追加・取得
- 現在位置の管理

#### B: Tree/Branch Logic（分岐ロジック）
- 分岐の作成・切り替え・削除
- ツリーノードの走査
- 分岐マージ

#### C: Annotation（コメント・評価値）
- コメントの追加・取得・編集
- 評価値の管理
- 時間情報の管理

#### D: Serialization（変換・出力）
- SFEN文字列の生成
- 各フォーマットへの変換用データ提供
- クリップボード用テキスト生成

#### E: UI Integration（UI連携）
- Qt Model/View へのデータ提供
- シグナル発行
- 表示用文字列の生成

### 2. 依存関係の分析
- `GameRecordModel` を使用しているクラスの一覧を作成する
- 各利用者がどのカテゴリの機能を使用しているか分類する
- 循環依存の有無を確認する

### 3. 分割計画の策定
以下のクラス構成を提案する:
- `GameRecordModel`: 薄いファサード（既存API互換）
- `MoveTreeManager`: 分岐ツリーの構造管理（カテゴリB）
- `GameAnnotationStore`: コメント・評価値・時間情報（カテゴリC）
- 必要に応じて追加クラスを提案する

各クラスの責務・メソッド一覧・依存関係を明記する。

### 4. 実装順序の提案
段階的に分割できる順序を提案する（各段階でビルド可能であること）。

## 出力
`docs/dev/done/gamerecordmodel-split-analysis.md` に分析結果と計画を記載する。

## 完了条件
- [ ] 全メソッドがカテゴリ分類されている
- [ ] 依存関係が明確になっている
- [ ] 分割後の各クラスの責務が明確に定義されている
- [ ] 段階的な実装計画がある

## 注意事項
- この段階ではコード変更は行わない（分析のみ）
- `GameRecordModel` は多くのクラスから参照されているため、API互換性を重視する
- 分岐ツリーのデータ構造は複雑なため、慎重に分離境界を設定する
