# Task 15: CSA/JKF/USI/USEN コンバータ移行（ISSUE-033）

## フェーズ
D: 変換器共通化と異常系強化

## 前提条件
- Task 14（ISSUE-032: KIF/KI2 移行）が完了していること

## 目的
残りの4コンバータ（CSA, JKF, USI, USEN）を共通パイプラインへ段階移行し、重複削減を完了する。

## 対象ファイル
- `src/kifu/formats/csatosfenconverter.h/.cpp` — CSA形式コンバータ
- `src/kifu/formats/jkftosfenconverter.h/.cpp` — JKF形式コンバータ
- `src/kifu/formats/usitosfenconverter.h/.cpp` — USI形式コンバータ
- `src/kifu/formats/usentosfenconverter.h/.cpp` — USEN形式コンバータ
- `src/kifu/formats/parsecommon.h/.cpp` — 共通処理

## 詳細手順

### Step 1: CSA/JKF コンバータの移行（PR-033-a 相当）

#### CSA コンバータ
1. `csatosfenconverter.cpp` を読み、共通化可能な部分を特定
2. CSA固有の表記（`+7776FU` 形式）のパース部分を保持しつつ、共通変換を `parsecommon` 経由に
3. テスト実行: `ctest --output-on-failure -R csa`

#### JKF コンバータ
1. `jkftosfenconverter.cpp` を読み、JSON パース以外の共通部分を特定
2. JSON 構造の解釈は JKF 固有、指し手の適用は共通化
3. テスト実行: `ctest --output-on-failure -R jkf`

### Step 2: USI/USEN コンバータの移行（PR-033-b 相当）

#### USI コンバータ
1. `usitosfenconverter.cpp` を読む
2. USI は元々SFEN ベースなので共通化の余地は少ないが、エラーハンドリングを統一
3. テスト実行

#### USEN コンバータ
1. `usentosfenconverter.cpp` を読む
2. USEN 固有のエンコーディング変換は保持しつつ、手適用を共通化
3. テスト実行

### Step 3: ビルド・全テスト
```bash
cmake --build build
cd build && ctest --output-on-failure
```

## 完了条件
- [ ] 全 converter テストが Pass
- [ ] 全テスト Pass
- [ ] 共通処理の利用が全コンバータに広がっている
- [ ] 各コンバータの行数が削減されている

## 検証コマンド
```bash
cmake --build build
cd build && ctest --output-on-failure
wc -l src/kifu/formats/*tosfenconverter.cpp
wc -l src/kifu/formats/parsecommon.cpp
```
