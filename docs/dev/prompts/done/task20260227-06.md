# Task 06: GameStartCoordinator 分割と再配線（ISSUE-012）

## フェーズ
B: 高リスク領域の分割（司令塔）

## 前提条件
- Task 05（ISSUE-011: MatchCoordinator 実装分割）が完了していること

## 目的
`gamestartcoordinator.cpp`（1181行）の責務を分離し、ダイアログ値解釈・開始準備・配線処理を分割する。

## 現状
- `gamestartcoordinator.cpp`: 1181行
- 対局開始ダイアログの値解釈、対局モード判定、エンジン初期化、配線処理が集中
- `matchcoordinatorwiring.cpp` との責務境界が曖昧

## 対象ファイル
- `src/game/gamestartcoordinator.h` — 分割元ヘッダー
- `src/game/gamestartcoordinator.cpp` — 分割元実装
- `src/ui/wiring/matchcoordinatorwiring.h/.cpp` — 配線責務の受け皿
- `src/game/gamestartorchestrator.h/.cpp` — 既存の抽出クラス（参考パターン）
- 新規クラスファイル（必要に応じて）
- `CMakeLists.txt` — 新規ファイルの追加

## 詳細手順

### Step 1: 現在の責務分析
`gamestartcoordinator.cpp` を全文読み、メソッドを以下に分類:

1. **ダイアログ値解釈** — StartGameDialog の結果からパラメータを抽出
2. **対局モード判定** — HvH/HvE/EvE/CSA のモード決定ロジック
3. **開始準備** — エンジン初期化・盤面セットアップ
4. **配線処理** — signal/slot 接続のセットアップ
5. **ユーティリティ** — ヘルパー関数

### Step 2: 分割方針の決定
- **ダイアログ値解釈**: `GameStartOptionsBuilder` または static メソッドとして分離
- **開始準備**: 既存の `GameStartOrchestrator` へ必要に応じて統合
- **配線処理**: `MatchCoordinatorWiring` へ移動

### Step 3: 分割の実装

#### PR-012-a: 開始準備の抽出
1. ダイアログ値解釈と対局モード判定を独立クラスまたは static 関数に抽出
2. `GameStartCoordinator` は抽出先を呼び出す形にリファクタ
3. テスト実行で回帰なしを確認

#### PR-012-b: 配線の分離
1. `createAndWireMatch()` 系の配線処理を `MatchCoordinatorWiring` へ移動
2. `GameStartCoordinator` からの配線呼び出しを委譲に変更
3. テスト実行で回帰なしを確認

### Step 4: CMakeLists.txt の更新
新規ファイルがあれば追加。`scripts/update-sources.sh` で確認。

### Step 5: ビルド・テスト
```bash
cmake --build build
cd build && ctest --output-on-failure
```

## 完了条件
- [ ] 対局開始フローが互換動作（全テスト Pass）
- [ ] `gamestartcoordinator.cpp` の行数が削減（目標: 800行以下）
- [ ] 責務境界が明確になっている
- [ ] 構造KPIテストが Pass

## 検証コマンド
```bash
cmake --build build
cd build && ctest --output-on-failure
wc -l src/game/gamestartcoordinator.cpp src/game/gamestartcoordinator.h
cd build && ctest --output-on-failure -R tst_structural_kpi
```
