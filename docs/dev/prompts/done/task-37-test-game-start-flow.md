# Task 37: 対局開始フローの回帰テスト追加

## Workstream D-1: テスト拡充と品質ゲート

## 目的

Workstream A〜C のリファクタリングで回帰を確実に検出するため、対局開始フローのテストを追加・強化する。

## 背景

- 既存テストは 22 本整備されている
- 対局開始フローは複雑で、リファクタリングによる回帰リスクが高い
- 現在のテストでは対局開始フローのカバレッジが不十分な可能性がある

## 対象ファイル

- `tests/` 配下に新規テストファイルを追加
- テスト対象: `MatchCoordinator`, `GameStartCoordinator`, 関連クラス

## 実装内容

以下のシナリオについてテストを追加する:

1. **現在局面開始**
   - 分岐あり: 分岐が存在する局面からの対局開始
   - 分岐なし: 通常の局面からの対局開始

2. **プリセット開始**
   - 平手（初期局面）からの対局開始
   - 駒落ち（各種駒落ち局面）からの対局開始

3. **連続対局設定**
   - 連続対局モードの設定と動作

4. **PlayMode 別起動**
   - HvH（人 vs 人）の起動
   - HvE（人 vs エンジン）の起動
   - EvE（エンジン vs エンジン）の起動

テストは `QT_QPA_PLATFORM=offscreen` で実行可能なユニットテストとして作成すること。

## 制約

- 既存テストを壊さない
- GUI 環境がなくても実行可能（offscreen）
- テストは独立して実行可能であること

## 受け入れ条件

- 上記シナリオのテストが追加されている
- 全テスト（既存 + 新規）が通過する
- テストが対局開始フローの回帰を検出できる

## 検証コマンド

```bash
cmake -B build -S .
cmake --build build
QT_QPA_PLATFORM=offscreen ctest --test-dir build --output-on-failure -j4
```

## 出力

- 追加したテストファイル一覧
- テストケースの説明
- テスト実行結果
- カバレッジの改善点
